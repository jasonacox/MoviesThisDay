<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- SEO Meta Tags -->
    <meta name="description" content="Discover movies released on this day in history. Explore film anniversaries, new releases, and classic cinema by date with MoviesThisDay.">
    <meta name="keywords" content="movies, movie anniversaries, film history, movies released today, movie database, cinema, new releases, classic movies, film dates, MoviesThisDay">
    <meta name="author" content="MoviesThisDay">
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Movies Released Today in History – MoviesThisDay">
    <meta property="og:description" content="Discover movies released on this day in history. Explore film anniversaries, new releases, and classic cinema by date.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://moviesthisday.com/">
    <meta property="og:image" content="https://moviesthisday.com/static/og-image.png">
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Movies Released Today in History – MoviesThisDay">
    <meta name="twitter:description" content="Discover movies released on this day in history. Explore film anniversaries, new releases, and classic cinema by date.">
    <meta name="twitter:image" content="https://moviesthisday.com/static/og-image.png">
    <meta name="twitter:site" content="@MoviesOnThisDay">
    <!-- Structured Data: JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "MoviesThisDay",
      "url": "https://moviesthisday.com/",
      "description": "Discover movies released on this day in history. Explore film anniversaries, new releases, and classic cinema by date.",
      "potentialAction": [
        {
          "@type": "SearchAction",
          "target": "https://moviesthisday.com/movies/by-day/{mm_dd}",
          "query-input": "required name=mm_dd"
        },
        {
          "@type": "SearchAction",
          "target": "https://moviesthisday.com/movies/today",
          "query-input": "optional"
        }
      ]
    }
    </script>
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <title>Movies Released Today in History – MoviesThisDay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f3f6fa; }
        .container { margin-top: 40px; }
        h1 { font-weight: 700; margin-bottom: 30px; }
        table { background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 16px rgba(30,41,59,0.07); }
        thead { background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%); color: #fff; }
        tbody tr:hover { background: #e0e7ef; }
        .date-nav {
            background: #fff;
            border-radius: 12px;
            padding: 24px 16px;
            box-shadow: 0 4px 24px rgba(30,41,59,0.08);
            margin-bottom: 24px;
        }
        .date-nav label { font-weight: 600; color: #2563eb; }
        .date-nav input[type="date"] {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #b6c6e3;
            background: #f8fafc;
            color: #22223b;
        }
        .btn-primary {
            background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%);
            border: none;
        }
        .btn-primary:hover, .btn-primary:focus {
            background: linear-gradient(90deg, #1d4ed8 0%, #3b82f6 100%);
        }
        .btn-outline-secondary {
            border-color: #b6c6e3;
            color: #2563eb;
            background: #f8fafc;
        }
        .btn-outline-secondary:hover, .btn-outline-secondary:focus {
            background: #e0e7ef;
            color: #1d4ed8;
            border-color: #60a5fa;
        }
        @media (max-width: 991px) {
            .row.flex-lg-nowrap { flex-wrap: wrap !important; }
        }
        /* Footer styles */
        .footer {
            background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%);
            color: #fff;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 -2px 8px rgba(30,41,59,0.07);
            border-bottom: none;
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0 !important;
            padding-top: 12px !important;
            padding-bottom: 12px !important;
        }
        .footer a {
            color: #e0e7ef;
            text-decoration: underline;
        }
        /* Header styles */
        .header-bar {
            font-size: 1.15rem;
            background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%);
            color: #fff;
            padding: 14px 0 12px 0;
            margin-bottom: 0;
            z-index: 1100;
            box-shadow: 0 2px 8px rgba(30,41,59,0.07);
        }
        .header-bar span {
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .header-bar .tagline {
            font-size: 0.97rem;
            color: #e0e7ef;
        }
        .nav-link {
            color: #e0e7ef;
            transition: color 0.3s;
        }
        .nav-link:hover, .nav-link:focus {
            color: #fff;
            text-decoration: underline;
        }
        .nav-link.active {
            color: #fff;
            font-weight: 500;
        }
        .movie-hover-card {
            display: none;
            position: absolute;
            z-index: 2000;
            min-width: 320px;
            max-width: 340px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(30,41,59,0.18);
            padding: 18px 18px 14px 18px;
            font-size: 1rem;
            color: #22223b;
            pointer-events: none;
            transition: opacity 0.15s;
        }
        .movie-hover-card .hover-title {
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
        }
        .movie-hover-card .hover-studio {
            color: #2563eb;
            font-size: 0.98rem;
            margin-bottom: 0.2rem;
        }
        .movie-hover-card .hover-desc {
            font-size: 0.98rem;
            color: #444;
            font-style: italic;
            margin-bottom: 0.5rem;
        }
        .movie-hover-card .hover-poster {
            float: right;
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 7px;
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(30,41,59,0.10);
        }
        .movie-hover-card .imdb-bar {
            display: flex;
            align-items: center;
            gap: 2px;
            margin-top: 4px;
            margin-bottom: 2px;
        }
        .movie-hover-card .imdb-bar span {
            width: 13px;
            height: 13px;
            border-radius: 2px;
            display: inline-block;
        }
        .movie-hover-card .imdb-label {
            font-size: 0.97em;
            color: #f5c518;
            font-weight: 600;
            margin-right: 6px;
        }
    </style>
    <script>
        let lastClientDate = getLocalDateString();
        function goToDate() {
            const dateInput = document.getElementById('dateInput').value;
            if (dateInput) {
                const [yyyy, mm, dd] = dateInput.split('-');
                const url = new URL(window.location.href);
                url.searchParams.set('date', `${mm}-${dd}`);
                // Always preserve the original client_date if present
                if (!url.searchParams.has('client_date')) {
                    url.searchParams.set('client_date', getLocalDateString());
                }
                window.location.href = url.pathname + '?' + url.searchParams.toString();
            }
        }
        function setClientDateParam() {
            // On first load, if client_date is not present, reload with it
            const url = new URL(window.location.href);
            if (!url.searchParams.has('client_date')) {
                const localDate = getLocalDateString();
                url.searchParams.set('client_date', localDate);
                window.location.replace(url.toString());
            }
        }
        function getLocalDateString() {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            return now.toISOString().slice(0, 10);
        }
        function getCurrentDisplayDate() {
            // Use the value in the date input, or fallback to today if empty/invalid
            const input = document.getElementById('dateInput');
            let date = new Date(input.value);
            if (isNaN(date)) {
                date = new Date();
                date.setMinutes(date.getMinutes() - date.getTimezoneOffset());
            }
            return date;
        }
        function pickToday() {
            document.getElementById('dateInput').value = getLocalDateString();
            goToDate();
        }
        function changeDay(delta) {
            const input = document.getElementById('dateInput');
            let date = getCurrentDisplayDate();
            // Add delta days using setDate (handles month/year overflow correctly)
            date.setDate(date.getDate() + delta);
            input.value = date.toISOString().slice(0, 10);
            goToDate();
        }
        function changeMonth(delta) {
            const input = document.getElementById('dateInput');
            let date = getCurrentDisplayDate();
            let m = date.getMonth() + delta;
            let y = date.getFullYear();
            let day = date.getDate();
            if (m < 0) { m = 11; y--; }
            if (m > 11) { m = 0; y++; }
            // Clamp to last day of month if needed
            const lastDay = new Date(y, m + 1, 0).getDate();
            if (day > lastDay) day = lastDay;
            date.setFullYear(y, m, day);
            input.value = date.toISOString().slice(0, 10);
            goToDate();
        }
        // Set calendar to current date on load, or to the date in the URL if present
        window.addEventListener('DOMContentLoaded', () => {
            setClientDateParam();
            const input = document.getElementById('dateInput');
            const urlParams = new URLSearchParams(window.location.search);
            const dateParam = urlParams.get('date');
            let dateStr;
            if (dateParam) {
                // dateParam is MM-DD, convert to YYYY-MM-DD using current year
                const today = new Date();
                const yyyy = today.getFullYear();
                const [mm, dd] = dateParam.split('-');
                dateStr = `${yyyy}-${mm.padStart(2, '0')}-${dd.padStart(2, '0')}`;
            } else {
                dateStr = getLocalDateString();
            }
            // Only set if different to avoid flicker
            if (input.value !== dateStr) {
                input.value = dateStr;
            }
            // Start interval to check for date change
            setInterval(() => {
                const currentClientDate = getLocalDateString();
                if (currentClientDate !== lastClientDate) {
                    // Update client_date param and reload
                    const url = new URL(window.location.href);
                    url.searchParams.set('client_date', currentClientDate);
                    window.location.replace(url.toString());
                }
                lastClientDate = currentClientDate;
            }, 60000); // check every 60 seconds
        });
        const movieCache = {}; // Global cache for movie data

        async function createMovieHoverCard(movieId, anchor) {
            // Check if movie data is in cache
            let movie = movieCache[movieId];
            if (!movie) {
                // Fetch movie data if not in cache
                try {
                    const response = await fetch(`/movie/${movieId}`);
                    if (!response.ok) throw new Error('Failed to fetch movie data');
                    movie = await response.json();
                    movieCache[movieId] = movie; // Store in cache
                } catch (error) {
                    console.error('Error fetching movie data:', error);
                    return; // Exit if fetch fails
                }
            }
            // Remove any existing card
            let oldCard = document.getElementById('movie-hover-card');
            if (oldCard) oldCard.remove();
            // Build card
            let card = document.createElement('div');
            card.className = 'movie-hover-card';
            card.id = 'movie-hover-card';
            // Poster
            let poster = movie.omdb_poster ? `<img class='hover-poster' src='${movie.omdb_poster}' alt='Movie Poster for ${movie.title ? movie.title.replace(/\"/g, '&quot;') : 'movie'}' onerror="this.onerror=null;this.src='/static/placeholder-poster.png';this.alt='No poster available';">` : '';
            // Title
            let title = `<div class='hover-title'>${movie.title || ''}`;
            if (movie.is_new_release) {
                title += ` <span class='badge bg-success ms-2' style='font-size:0.85em;'>New Release</span>`;
            }
            title += `</div>`;
            // Studio
            let studio = movie.production_companies ? `<div class='hover-studio'>${movie.production_companies}</div>` : '';
            // Description
            let desc = '';
            if (movie.omdb_plot) {
                desc = `<div class='hover-desc'>${movie.omdb_plot}`;
                if (movie.omdb_rated) {
                    let rated = movie.omdb_rated.trim();
                    let ratedLower = rated.toLowerCase();
                    let ratedSuffix = '';
                    if (rated === 'A' || ratedLower === 'approved') {
                        ratedSuffix = '(Approved)';
                    } else if (
                        rated === 'NR' ||
                        ratedLower === 'n/a' ||
                        ratedLower === 'not rated' ||
                        rated === ''
                    ) {
                        ratedSuffix = '(Not Rated)';
                    } else {
                        ratedSuffix = `(Rated ${rated})`;
                    }
                    desc += ` <span style='color:#888; font-size:0.97em;'>${ratedSuffix}</span>`;
                } else {
                    desc += ` <span style='color:#888; font-size:0.97em;'>(Not Rated)</span>`;
                }
                desc += `</div>`;
            }
            // IMDB rating bar
            let imdbBar = '';
            if (movie.omdb_imdb_rating) {
                let rating = movie.omdb_imdb_rating.split('/')[0];
                let ratingVal = parseFloat(rating);
                if (isNaN(ratingVal) || ratingVal < 0 || ratingVal > 10) {
                    ratingVal = 0; // Fallback to 0 if invalid
                }
                imdbBar = `<div class='imdb-label'>IMDb Rating</div><div class='imdb-bar'>`;
                for (let i = 1; i <= 10; i++) {
                    imdbBar += `<span style='background-color:${i <= Math.floor(ratingVal) ? '#f5c518' : '#e5e7eb'};'></span>`;
                }
                imdbBar += `<span style='font-size:0.97em; color:#444; margin-left:6px;'>${ratingVal}/10</span></div>`;
            }
            card.innerHTML = `${poster}${title}${studio}${desc}${imdbBar}`;
            document.body.appendChild(card);
            // Position card
            const rect = anchor.getBoundingClientRect();
            let top = rect.bottom + window.scrollY + 6;
            let left = rect.left + window.scrollX;
            // Check if popup would be below the fold
            card.style.display = 'block'; // Temporarily show to get height
            let cardHeight = card.offsetHeight;
            let willOverflowBottom = (top + cardHeight > window.scrollY + window.innerHeight);
            if (willOverflowBottom) {
                // Show above the link
                top = rect.top + window.scrollY - cardHeight - 6;
                if (top < window.scrollY) top = window.scrollY + 8; // Clamp to top
            }
            if (left + card.offsetWidth > window.innerWidth - 20) {
                left = window.innerWidth - card.offsetWidth - 20;
            }
            card.style.top = `${top}px`;
            card.style.left = `${left}px`;
            card.style.opacity = 1;
        }
        function removeMovieHoverCard() {
            let card = document.getElementById('movie-hover-card');
            if (card) card.remove();
        }
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.movie-title-link').forEach(function(link) {
                let timeout;
                link.addEventListener('mouseenter', function(e) {
                    timeout = setTimeout(() => {
                        // Pass imdbId string, not the link element, to createMovieHoverCard
                        createMovieHoverCard(link.dataset.imdbId, link);
                    }, 200);
                });
                link.addEventListener('mouseleave', function(e) {
                    clearTimeout(timeout);
                    removeMovieHoverCard();
                });
            });
            // Remove card if mouse leaves card
            document.body.addEventListener('mousemove', function(e) {
                let card = document.getElementById('movie-hover-card');
                if (card && !card.contains(e.target) && !e.target.classList.contains('movie-title-link')) {
                    card.remove();
                }
            });
        });
    </script>
</head>
<body>
    <div class="header-bar fixed-top d-flex align-items-center justify-content-between px-3">
        <div class="d-flex align-items-center">
            <a href="/" style="text-decoration:none; color:inherit;"><span style="font-size:1.25rem; font-weight:700; letter-spacing:0.5px;">MoviesThisDay</span></a>
            <span class="ms-2 tagline d-none d-md-inline">Discover movies released on this day in history.</span>
        </div>
        <nav class="d-flex align-items-center ms-auto">
            <a class="nav-link d-inline px-2 {% if request.url.path == '/' %}active{% endif %}" href="/">Home</a>
            <a class="nav-link d-inline px-2 {% if request.url.path == '/about' %}active{% endif %}" href="/about">About</a>
            <a class="nav-link d-inline px-2 {% if request.url.path == '/search' %}active{% endif %}" href="/search">Search</a>
        </nav>
    </div>
    <div class="container" style="padding-top:20px;">
        <div class="row flex-lg-nowrap">
            <div class="col-lg-3 mb-4 d-flex flex-column align-items-center justify-content-start sticky-lg-top" style="top:80px">
                <div class="text-center mb-4" style="margin-top:50px;">
                    <h1 style="font-size:1.5rem; font-weight:700;">Movies Released on<br>This Day in History</h1>
                    <h5 class="mb-0">
                        {% if today_str == current_date_str %}
                            Today ({{ today_str }})
                        {% else %}
                            Showing {{ today_str }}
                        {% endif %}
                    </h5>
                </div>
                <div class="date-nav mt-4" style="width:100%; max-width:240px;">
                    <label for="dateInput" class="form-label">Jump to Date</label>
                    <input type="date" id="dateInput" class="form-control mb-2" onchange="goToDate()">
                    <div class="d-flex gap-2 mb-2">
                        <button class="btn btn-outline-secondary flex-fill w-50" type="button" onclick="changeDay(-1)">&lt; Day</button>
                        <button class="btn btn-outline-secondary flex-fill w-50" type="button" onclick="changeDay(1)">Day &gt;</button>
                    </div>
                    <div class="d-flex gap-2 mb-2">
                        <button class="btn btn-outline-secondary flex-fill w-50" type="button" onclick="changeMonth(-1)">&lt; Month</button>
                        <button class="btn btn-outline-secondary flex-fill w-50" type="button" onclick="changeMonth(1)">Month &gt;</button>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary flex-fill w-50" onclick="goToDate()">Go</button>
                        <button class="btn btn-outline-secondary flex-fill w-50" type="button" onclick="pickToday()">Today</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-9 d-flex flex-column" style="height: 90vh; padding-bottom:40px;">
                <form class="mb-3 d-flex justify-content-end align-items-center" method="get" id="filterForm">
                    {% if request.query_params.get('date') %}
                        <input type="hidden" name="date" value="{{ request.query_params.get('date') }}">
                    {% endif %}
                    <label for="sort" class="me-2 mb-0">Sort by:</label>
                    <select name="sort" id="sort" class="form-select w-auto me-2" onchange="document.getElementById('filterForm').submit()">
                        <option value="popularity" {% if sort_by == 'popularity' %}selected{% endif %}>Popularity</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name</option>
                        <option value="year" {% if sort_by == 'year' %}selected{% endif %}>Year</option>
                    </select>
                    <label for="rated_filter" class="me-2 mb-0 ms-3">Rated:</label>
                    <select name="rated_filter" id="rated_filter" class="form-select w-auto me-2" onchange="document.getElementById('filterForm').submit()">
                        <option value="all" {% if request.query_params.get('rated_filter', 'all') == 'all' %}selected{% endif %}>All</option>
                        <option value="g" {% if request.query_params.get('rated_filter') == 'g' %}selected{% endif %}>G</option>
                        <option value="tv-y7" {% if request.query_params.get('rated_filter') == 'tv-y7' %}selected{% endif %}>TV-Y7</option>
                        <option value="pg" {% if request.query_params.get('rated_filter') == 'pg' %}selected{% endif %}>PG</option>
                        <option value="pg-13" {% if request.query_params.get('rated_filter') == 'pg-13' %}selected{% endif %}>PG-13</option>
                        <option value="r" {% if request.query_params.get('rated_filter') == 'r' %}selected{% endif %}>R</option>
                        <option value="nc-17" {% if request.query_params.get('rated_filter') == 'nc-17' %}selected{% endif %}>NC-17</option>
                    </select>
                </form>
                <div class="flex-grow-1 overflow-auto table-responsive min-height-0">
                    <table class="table table-striped table-hover shadow mb-0" style="table-layout:fixed; min-width:600px;">
                        <thead>
                            <tr>
                                <th style="width:auto; min-width:140px;" class="text-truncate">Title</th>
                                <th style="width:70px;">Rated</th>
                                <th style="width:70px;">Year</th>
                                <th style="width:80px;">Runtime</th>
                                <th style="width:120px;">Popularity</th>
                                <th style="width:70px;">Link</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for movie in movies %}
                            {% set rated_map = {
                                'g': 1,
                                'tv-y7': 2,
                                'pg': 3, 'approved': 3,
                                'pg-13': 4, 'pg13': 4, 'tv-14': 4,
                                'r': 5,
                                'nc-17': 6, 'nc17': 6,
                                'nr': 7, 'not rated': 7, 'unrated': 7, '': 7, None: 7, 'n/a': 7,
                            } %}
                            {% set rated_val = rated_map.get(movie.omdb_rated|lower, 0) %}
                            {% set filter_val = rated_map.get(request.query_params.get('rated_filter', 'all')|lower, 99) %}
                            {% if request.query_params.get('rated_filter', 'all') == 'all' or rated_val <= filter_val %}
                            <tr>
                                <td class="text-truncate" style="max-width:180px; word-break:break-word; white-space:nowrap;">
                                    {% if movie.imdb_id %}
                                        <a href="/details/{{ movie.imdb_id }}" class="movie-title-link" data-imdb-id="{{ movie.imdb_id }}" style="color:#111; text-decoration:none; font-weight:inherit;">{{ movie.title }}</a>
                                    {% else %}
                                        {{ movie.title }}
                                    {% endif %}
                                    {% if movie.is_new_release %}
                                        <span class="badge bg-success ms-2" style="font-size:0.85em;">New Release</span>
                                    {% endif %}
                                </td>
                                <td style="font-size:0.87em; color:#888888; text-align:left;">
                                    {% if movie.omdb_rated %}
                                        {% if movie.omdb_rated|lower == 'not rated' %}NR
                                        {% elif movie.omdb_rated|lower == 'approved' %}A
                                        {% else %}{{ movie.omdb_rated }}{% endif %}
                                    {% else %}-{% endif %}
                                </td>
                                <td>{{ movie.release_year }}</td>
                                <td>{% if movie.runtime %}{{ movie.runtime }} min{% else %}-{% endif %}</td>
                                <td>
                                    {% set pop = movie.popularity|float(0) %}
                                    {% set pop_pct = (pop / popularity_max * 50) if popularity_max and popularity_max > 0 else (pop if pop < 100 else 100) %}
                                    {% if pop_pct > 100 %}{% set pop_pct = 100 %}{% endif %}
                                    <div style="background:#e0e7ef; border-radius:6px; height:18px; width:100px; position:relative;">
                                        <div style="background:linear-gradient(90deg,#2563eb,#60a5fa); height:100%; border-radius:6px; width:{{ pop_pct|round(0,'floor') }}%; transition:width 0.3s;"></div>
                                        <span style="position:absolute; left:8px; top:0; font-size:0.95em; color:#222; line-height:18px; font-weight:500;">{{ pop|round(0,'floor') }}</span>
                                    </div>
                                </td>
                                <td>
                                    {% if movie.imdb_id %}
                                        <a href="https://www.imdb.com/title/{{ movie.imdb_id }}" target="_blank" rel="noopener" style="color:#888; font-weight:600; text-decoration:none;">IMDb</a>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="footer text-center" style="font-size:0.95rem;">
        Powered by <a href="https://github.com/jasonacox/MoviesThisDay" target="_blank">MoviesThisDay</a> | Version: {{ version }}
    </div>
</body>
</html>
